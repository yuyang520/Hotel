<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
        body, html{width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=
PFgBspYSe1HEwdM7pd8z0jEA1gG1pYG5"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Motel Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template,
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />
    <script type="applijewelleryion/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
    <link href="/public/css/bootstrap.min.css" rel='stylesheet' type='text/css' />
    <!-- Custom Theme files -->
    <link href="/public/css/style.css" rel='stylesheet' type='text/css' />
    <script src="/public/js/jquery-1.11.1.min.js"></script>
    <style>
        .tab-chapter{
            width: 800px;
        }
        .largetext{
            font-size: 20px;
            color: #a1a1a1;
        }
        #allmap{
            float:left; width:100%; height:100%;
        }
        .sidebar-head {
            position: fixed;
            z-index: 5;
            height: 5%;
            font-size: 16px;
            color: #1a2226;

        }

    </style>
    <script type="text/javascript" src="/public/js/bootstrap.min.js"></script>
</head>
<body>
<script th:inline="javascript">
    var hotel = [[${hotels}]];
    console.info(hotel);
</script>

<div style="width: 100%;height: 100%">
    <div style="width: 100%; height: 10%;top: 0px;background:#d9edf7; position: fixed;z-index: 4">
        <div>
            <div class="col-md-10 dropdown-buttons">
                <div class="col-md-3 dropdown-button">
                    <div class="input-group">
                        <input autocomplete="off" class="form-control has-dark-background"
                               name="hotelname" id="hotelname" placeholder="酒店名称：" type="text">
                    </div>
                </div>
                <link rel="stylesheet" href="/public/css/jquery-ui.small.css" />
                <script src="/public/js/jquery-ui.js"></script>
                <div class="col-md-3 dropdown-button" >
                    <div class="input-group">
                        <input autocomplete="off" class="form-control has-dark-background"
                               id="minPrice" name="minPrice" type="text" placeholder="最低价格：" >
                    </div>
                </div>
                <div class="col-md-3 dropdown-button">
                    <div class="input-group">
                        <input autocomplete="off" class="form-control has-dark-background"
                               id="city" name="city" type="text" placeholder="城市：">
                    </div>
                </div>
                <div class="col-md-3 dropdown-button" >
                    <div class="select_1">
                        <select id="starlevel" name="starlevel"  class="frm-field required">
                            <option value="6">全部</option>
                            <option value="5">5星</option>
                            <option value="4">4星</option>
                            <option value="3">3星</option>
                            <option value="2">2星</option>
                            <option value="1">1星</option>
                            <option value="0">无星级</option>
                        </select>
                    </div>
                </div>
                <div class="clearfix"> </div>
            </div>
            <div class="col-md-2 submit_button">
                <button value="查询" onclick="theLocation()">查询</button>
            </div>
        </div>
    </div>
    <div style="width: 100%;height: 90%; top: 10%;position: fixed;">
        <div style=" width:100%;height:100%;display: flex;flex-direction: row;align-content: center">
            <div style="flex:7">
                <div id="allmap" ></div>
            </div>
            <div style="flex:3;">
                <div class="sidebar-head">
                    <span style="color: #1a2226;font-size: 20px">查询到酒店<span id="hotelNumber"></span>个</span>
                </div>
                <div style="position:fixed;overflow: auto;top:15%;height: 85%;width:30%">
                    <table id="hotelTable" class="table-hover"  align="center"></table>
                </div>
            </div>
        </div>

        <div style="width: 30%; height: 100%; float: right;"></div>

    </div>
</div>




</body>
</html>
<script type="text/javascript" >
    // 百度地图API功能
    var MapData = null;
    var map = new BMap.Map("allmap");
    var top_left_control = new BMap.ScaleControl({anchor: BMAP_ANCHOR_TOP_LEFT});// 左上角，添加比例尺
    var top_left_navigation = new BMap.NavigationControl();  //左上角，添加默认缩放平移控件
    var data = hotel;
    map.addControl(top_left_control);
    map.addControl(top_left_navigation);
    if(data.length!=0) {
        map.centerAndZoom(new BMap.Point(data[0].hotelLongitude,data[0].hotelLatitude),11);
    }else{
        map.centerAndZoom(new BMap.Point(116.331398,39.897445),11);
    }

    map.enableScrollWheelZoom(true);

    map.clearOverlays();
    var opts = {
        width : 250,     // 信息窗口宽度
        height: 200,     // 信息窗口高度
        title : "酒店信息" , // 信息窗口标题
        enableMessage:true,//设置允许信息窗发送短息
    }
    for( let i = 0 ; i < data.length ; i ++ ) {
        var new_point = new BMap.Point( data[i].hotelLongitude,
            data[i].hotelLatitude);
        var marker = new BMap.Marker(new_point);  // 创建标注
        var content = "酒店名："+ data[i].hotelChineseName + "<br>地址：" +data[i].hotelAddress
            +"<br>描述:" +data[i].hotelProfile;
        map.addOverlay(marker);              // 将标注添加到地图中

        marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画
        marker.addEventListener("click",
            function(e){
                var p = e.target;
                var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
                var infoWindow = new BMap.InfoWindow(content, opts);  // 创建信息窗口对象
                map.openInfoWindow(infoWindow,point); //开启信息窗口

            });
    }

    var hotelTab = $("#hotelTable");
    hotelTab.empty();
    var htmlString = "";
    for( let i = 0 ; i < data.length ; i ++ ) {
        htmlString +=
            "<tr>"
            +"<td class='tab-chapter'>"
            +"<div style='left: auto'>"
            +"<h2 style='color: #92B8B1;'>"+data[i].hotelChineseName+"</h2><br/>"
            +"<span class='largetext'>地址：</span><span class='largetext' "
            +">"+data[i].hotelAddress+"</span><br/>"
            +"<span class='largetext'>星级：</span><span class='largetext'>";
        for( let j = 0 ; j < data[i].hotelStars ; j ++ ) {
            htmlString+="<img src='/public/images/star.png' style='height: 20px; width: 20px;'>";
        }
        htmlString += "</span><br/>"
            +"<span class='largetext'>联系方式：</span><span class='largetext' >"+data[i].hotelContact+"</span><br/>"
            +"<br/><a class='hvr-shutter-in-horizontal'"
            +"href=\'/welcome/details?hotelId="+data[i].hotelId+"\'>预订</a>"
            +"</div> </td> </tr>";

    }
    hotelTab.append(htmlString);
    $("#hotelNumber").html(data.length);
    function theLocation(){
        Url="/searchmap/map.json?"
            +"hotelname="+$("#hotelname").val()
            +"&&minPrice="+$("#minPrice").val()
            +"&&city="+$("#city").val()
            +"&&starlevel="+$("#starlevel").val();
        $.ajax({
            url:Url,
            type:"post",
            success:function(data) {
                console.info(data);
                MapData = data;
                map.clearOverlays();
                var opts = {
                    width : 250,     // 信息窗口宽度
                    height: 200,     // 信息窗口高度
                    title : "酒店信息" , // 信息窗口标题
                    enableMessage:true,//设置允许信息窗发送短息
                }
                for( let i = 0 ; i < data.length ; i ++ ) {
                    var new_point = new BMap.Point( data[i].hotelLongitude,
                        data[i].hotelLatitude);
                    var marker = new BMap.Marker(new_point);  // 创建标注
                    var content = "酒店名："+ data[i].hotelChineseName + "<br>地址：" +data[i].hotelAddress
                        +"<br>描述:" +data[i].hotelProfile;
                    map.addOverlay(marker);              // 将标注添加到地图中

                    marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画
                    marker.addEventListener("click",
                        function(e){
                            var p = e.target;
                            var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
                            var infoWindow = new BMap.InfoWindow(content, opts);  // 创建信息窗口对象
                            map.openInfoWindow(infoWindow,point); //开启信息窗口

                        });
                }

                var hotelTab = $("#hotelTable");
                hotelTab.empty();
                var htmlString = "";
                for( let i = 0 ; i < data.length ; i ++ ) {
                    htmlString +=
                         "<tr>"
                        +"<td class='tab-chapter'>"
                        +"<div style='left: auto'>"
                        +"<h2 style='color: #92B8B1;'>"+data[i].hotelChineseName+"</h2><br/>"
                        +"<span class='largetext'>地址：</span><span class='largetext' "
                        +">"+data[i].hotelAddress+"</span><br/>"
                        +"<span class='largetext'>星级：</span><span class='largetext'>";
                    for( let j = 0 ; j < data[i].hotelStars ; j ++ ) {
                        htmlString+="<img src='/public/images/star.png' style='height: 20px; width: 20px;'>";
                    }
                    htmlString += "</span><br/>"
                        +"<span class='largetext'>联系方式：</span><span class='largetext' >"+data[i].hotelContact+"</span><br/>"
                        +"<br/><a class='hvr-shutter-in-horizontal'"
                        +"href=\'/welcome/details?hotelId="+data[i].hotelId+"\'>预订</a>"
                        +"</div> </td> </tr>";

                }
                hotelTab.append(htmlString);
                $("#hotelNumber").html(data.length);
            }
        })
    }
</script>
